---

- name: configure db
  ini_file: >
    dest=/etc/mysql/conf.d/mysqld_openstack.cnf
    section="{{ item.section }}"
    option="{{ item.option }}"
    value="{{ item.value }}"
    backup=yes
  become: yes
  become_method: sudo
  with_items:
    - section: mysqld
      option: bind-address
      value: "{{ manage_ip }}"
    - section: mysqld
      option: default-storage-engine
      value: innodb

- name: configure db
  lineinfile:
    dest: /etc/mysql/conf.d/mysqld_openstack.cnf
    line: "innodb_file_per_table"
  become: yes
  become_method: sudo

- name: configure db
  ini_file: >
    dest=/etc/mysql/conf.d/mysqld_openstack.cnf
    section="{{ item.section }}"
    option="{{ item.option }}"
    value="{{ item.value }}"
    backup=yes
  become: yes
  become_method: sudo
  with_items:
    - section: mysqld
      option: collation-server
      value: utf8_general_ci
    - section: mysqld
      option: init-connect
      value: "'SET NAMES utf8'"
    - section: mysqld
      option: character-set-server
      value: utf8

- name: restart mysql
  service:
    name: mysql
    enabled: yes
    state: restarted
  become: yes
  become_method: sudo

...
